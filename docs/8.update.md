# 初探 Update 流程

## update 流程与 mount 流程的区别。

对于 beginWork：

- 需要处理 ChildDeletion 的情况
- 需要处理节点移动的情況 （abc->bca）

对于 completeWork：

- 需要处理 HostText 内容更新的情况
- 需要处理 HostComponent 属性变化的情況对于 commitWork：
- 对于 ChildDeletion，需要遍历被删除的子树对于 useState：
- 实现相对于 mountState 的 updateState

## beginWork 流程

本节课仅处理单一节点，所以省去了「节点移动」的情况。我们需要处理：

- singleElement
- singleTextNode

处理流程为：

1. 比较是否可以复用 current fiber

   - a.比较 key，如果 key 不同，不能复用
   - b.比较 type，如果 type 不同，不能复用
   - c.如果 key 与 type 都相同，则可复用

2. 不能复用，则创建新的（同 mount 流程），可以复用则复用旧的

注意：对于同一个 fiberNode，即使反复更新，current、wip 这两个 fiberNode 会重复使用

## completeWork 流程

主要处理「标记 Update」的情况，本节课我们处理 HostText 内容更新的情况。
commitWork 流程
对于标记 ChildDeletion 的子树，由于子树中：

- 对于 FC，需要处理 useEffect unmout 执行、解绑 ref
- 对于 HostComponent，需要解绑 ref
- 对于子树的「根 HostComponent」，需要移除 DOM
  所以需要实现「遍历 ChildDeletion 子树」的流程
