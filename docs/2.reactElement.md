## JSX 的实现

React 项目结构：

- react（宿主环境无关的公用方法）
- react-reconciler（协调器的实现，宿主环境无关）
- 各种宿主环境的包
- shared（公用辅助方法，宿主环境无关）

本节课将实现的 JSX 转换属于 react 包。

### JSX 转换是什么

[「02」JSX 转换](https://juejin.cn/post/7219272135817674813)

[JSX 装換 playground](https://babeljs.io/repl/)

```jsx
<div id="demo">123</div>

import { jsx as _jsx } from "react/jsx-runtime";
/*#__PURE__*/_jsx("div", {
  id:"demo"
  children: "123"
});

/*#__PURE__*/React.createElement("div", {
  id: "demo"
}, "123");
```

我们可以在 `babel` 的 `playground` 看到 `jsx` 代码转换后的东西，当前是 `automatic` 模式，`jsx` 代码会被转换成 `_jsx` 方法的调用，这是`react17` 之后新增的。

从上面我们可以看到\_jsx 函数参数如下：

- 第一个参数是标签名也可以说是类型的字符串，
- 第二个参数应该是一些标签上的配置对象
- 第三个参数可以认为是标签的 children

**明确目标**

首先要明确我们的目标，JSX 转换的过程包括两部分

包括两部分：

- 编译时：这个阶段 babel 已经帮我们完成了
- 运行时：jsx 方法或 React.createElement 方法的实现（包括 dev、prod 两个环境）

编译时由 babel 编译实现，我们来实现运行时，工作量包括：

1. 实现 jsx 方法
2. 实现打包流程
3. 实现调试打包结果的环境

**实现 jsx 方法**

包括：

- jsxDEV 方法（dev 环境）
- jsx 方法（prod 环境）
- React.createElement

**实现打包流程**

对应上述两 3 方法，打包对应文件：

- react/jsx-dev-runtime.js (devEt)
- react/jsx-rumtime.js (prodift#)
- React

**调试打包结果**
[Pnpm link 文档](https://www.pnpm.cn/cli/link)
[pnpm link&npm link 使用](https://juejin.cn/post/7374608546480914459)

### React 元素与组件

[React 之元素与组件的区别](https://juejin.cn/post/7161320926728945701)

Babel 会把 JSX 转译成一个名为 `React.createElement()` 函数调用。以下两种示例代码完全等效：

###jsx 元素

```jsx
const element = <h1 className="greeting">Hello, world!</h1>;

const element = React.createElement(
  "h1",
  { className: "greeting" },
  "Hello, world!"
);
```

### 组件的渲染：

定义 welcome 组件

```jsx
// 函数组件
function Welcome(props) {
  return <h1>Hello, {props.name}</h1>;
}
// class 组件
class Welcome extends React.Component {
  render() {
    return <h1>Hello, {this.props.name}</h1>;
  }
}
```

使用组件

```jsx
const element = <Welcome name="Sara" />;
```

对于组件，我们要使用类似于 HTML 标签的方式进行调用，Babel 会将其转译为一个函数调用

```jsx
const element = React.createElement(Welcome, { name: "Sara" }, null);
```

### createElement

`React.createElement()` 会预先执行一些检查，以帮助你编写无错代码，但实际上它创建了一个这样的对象：

```jsx
const element = {
  type: "h1",
  props: {
    className: "greeting",
    children: "Hello, world!",
  },
};
```

这些对象被称为 “React 元素”。它们描述了你希望在屏幕上看到的内容。

你看，**React 元素其实就是指我们日常编写的 JSX 代码，它会被 Babel 转义为一个函数调用，最终得到的结果是一个描述 DOM 结构的对象，它的数据结构本质是一个 JS 对象**。
